

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>欢迎使用RiskQuantLib &mdash; RiskQuantLib 0.0.32 文档</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/readthedocs-custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="RiskQuantLib" href="modules.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> RiskQuantLib
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">主页</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">RiskQuantLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="Create_Project.html">创建一个新的工程</a></li>
<li class="toctree-l1"><a class="reference internal" href="Build_Project.html">编译你的工程</a></li>
<li class="toctree-l1"><a class="reference internal" href="Instrument.html">模板类</a></li>
<li class="toctree-l1"><a class="reference internal" href="Instrument_List.html">模板列表类</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tool.html">工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="Project_Management.html">模板管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Variable_Type.html">数据类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="With_QuantLib.html">与QuantLib配合使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="With_Pandas.html">与Pandas配合使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="With_ORM.html">与ORM配合使用</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">RiskQuantLib</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>欢迎使用RiskQuantLib</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="welcome-to-use-riskquantlib">
<h1>欢迎使用RiskQuantLib<a class="headerlink" href="#welcome-to-use-riskquantlib" title="永久链接至标题">¶</a></h1>
<p>RiskQuantLib是金融工程中著名的衍生品定价库Quantlib的一个衍生库，但不同于QuantLib，RiskQuantLib是一个金融数据分析脚手架。RiskQuantLib提供默认的python类文件，作为金融工具的模板类，并且在给定继承规则和其他信息的条件下，允许使用者通过RiskQuantLib自动创建更多自定义的python类。RiskQuantLib也提供自动化工具，来为创建的python类自动添加属性。</p>
<div class="section" id="why-should-i-use-riskquantlib">
<h2>为什么我应该使用RiskQuantLib？<a class="headerlink" href="#why-should-i-use-riskquantlib" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>RiskQuantLib提供了方便的工具来供金融分析师进行对象化编程。</p></li>
<li><p>RiskQuantLib是基于QuantLib实现的，你可以使用QuantLib的内置函数，并且可以很好地与RiskQuantLib相结合。</p></li>
<li><p>RiskQuantLib是一个脚手架，这意味着他可以为每一个数据分析项目单独新建一个工程，在新建工程之后，RiskQuantLib将会成为新工程的一部分，你可以更改工程中RiskQuantLib的源代码，使得RiskQuantLib符合当前工程的需要。</p></li>
<li><p>RiskQuantLib适用于不同的市场，所有的金融工具模板类是由使用者自定义的，这使得RiskQuantLib使用者有极大的自由度。</p></li>
<li><p>RiskQuantLib使得数据的处理流程彼此分开。使用RiskQuantLib，可以将数据存储，数据输入，数据分析，以及数据输出彼此隔离。你甚至可以在数据输入之前提前开始编写数据处理逻辑，而不是等待数据输入之后，再进行分析。</p></li>
<li><p>RiskQuantLib提供工程模板管理功能，使用者可以编写符合自己数据处理习惯的工程模板，比如股票收益分析，然后将这个模板保存为模板工程，与其他人分享。或者在遇见下一个相似的数据分析项目时，使用已有的模板工程来初始化新的工程。</p></li>
</ul>
</div>
<div class="section" id="who-can-use-riskquantlib">
<h2>谁适合使用RiskQuantLib？<a class="headerlink" href="#who-can-use-riskquantlib" title="永久链接至标题">¶</a></h2>
<p>RiskQuantLib是为了使金融分析师更快速，更方便地进行数据分析而设计的。任何金融分析师，金融相关专业的学生，量化交易员都可以使用RiskQuantLib。当需要处理多种金融工具时，RiskQuantLib尤为有用。</p>
<p><strong>注意: RiskQuantLib并不是为大数据分析而设计的，RiskQuantLib牺牲了运行速度和内存空间来换取更快的代码开发速度。</strong></p>
</div>
<div class="section" id="slow-start">
<h2>一个例子<a class="headerlink" href="#slow-start" title="永久链接至标题">¶</a></h2>
<p>假设你是一家著名的国际投行的员工。一天，你的老板叫你去办公室，他告诉你他想要投资一个家族基金，名为Archegos。如果你选择接受这份任务，老板将需要你通过数据研究，来计算这项投资的风险。</p>
<blockquote>
<div><p><cite>三思后的冒险，和鲁莽截然不同。</cite></p>
</div></blockquote>
<p>你调查了一番，从彭博获取了一些数据，但是这些数据只告诉你了Archegos的一些股票持仓，其中有一些中概股，比如腾讯或者阿里巴巴。你获取的第一个数据表格看起来像这样：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Holding Mkt Value</p></th>
<th class="head"><p>Stock</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>239018292</p></td>
<td><p>TCEHY US Equity</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>710281723</p></td>
<td><p>ABC US Equity</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>7497233</p></td>
<td><p>HIYJ US Equity</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>179321234</p></td>
<td><p>SPACEX US Equity</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>83249</p></td>
<td><p>HE US Equity</p></td>
</tr>
</tbody>
</table>
<p>在这之后，你决定下载一些股票在过去三年的每日收盘价，你的第二个数据表看起来像这样：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 27%" />
<col style="width: 28%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Date</p></th>
<th class="head"><p>HIYJ US Equity</p></th>
<th class="head"><p>U7HJ US Equity</p></th>
<th class="head"><p>HE US Equity</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2020-01-01</p></td>
<td><p>23.9</p></td>
<td><p>nan</p></td>
<td><p>9.8</p></td>
</tr>
<tr class="row-odd"><td><p>2020-01-02</p></td>
<td><p>nan</p></td>
<td><p>12.8</p></td>
<td><p>9.5</p></td>
</tr>
<tr class="row-even"><td><p>2020-01-03</p></td>
<td><p>21.9</p></td>
<td><p>13.1</p></td>
<td><p>9.3</p></td>
</tr>
<tr class="row-odd"><td><p>2020-01-04</p></td>
<td><p>22.1</p></td>
<td><p>13.2</p></td>
<td><p>9.7</p></td>
</tr>
<tr class="row-even"><td><p>2020-01-05</p></td>
<td><p>22.4</p></td>
<td><p>12.9</p></td>
<td><p>9.8</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<p>你决定计算Archegos股票持仓的历史波动率，你开始一段python编程计算，看起来像这样：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_stock_holding</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_one</span><span class="p">)</span>
<span class="n">df_stock_close</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_two</span><span class="p">)</span>
</pre></div>
</div>
<p>如果你不使用RiskQuantLib，你可能这样做：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_std</span> <span class="o">=</span> <span class="n">df_stock_close</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">std_of_archegos_stock_holdings</span> <span class="o">=</span> <span class="n">df_std</span><span class="p">[</span><span class="n">df_stock_holding</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
</pre></div>
</div>
<p>现在你对于自己的结果非常满意，似乎股票的部分风险已经可以被解释，至少在某种程度上，可以被解释。在下午，你的老板又告诉你，他知道Archegos还持有两支著名基金，名为H和JK，他告诉你这是重大非公开信息，所以你可能无法仅凭自己找到这两支基金的单位净值，幸运的是，你的老板通过某种手段找到了这些信息，这就是你拿到的第三个数据表格，他看起来像这样：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Net Asset Value</p></th>
<th class="head"><p>Fund</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>2.39</p></td>
<td><p>H</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>7.22</p></td>
<td><p>JK</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>0.98</p></td>
<td><p>UIH</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<p>Archegos对于这两支基金的持仓份额是你的第四个数据表，它看起来像这样：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 40%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Holding Shares</p></th>
<th class="head"><p>Fund</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>20000000</p></td>
<td><p>H</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>45000000</p></td>
<td><p>JK</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<p>你的同事曾经进行过一个关于单位净值的极端回撤的研究，他告诉你，你可以使用1.5%作为单日99%置信度的VaR（在险价值），所以你听从了他的建议，你这样计算风险指标：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_fund_holding</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_four</span><span class="p">)</span>
<span class="n">df_fund_nav</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_three</span><span class="p">)</span>

<span class="n">df_fund</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_fund_holding</span><span class="p">,</span> <span class="n">df_fund_nav</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;Fund&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">df_fund</span><span class="p">[</span><span class="s1">&#39;Total Holding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_fund</span><span class="p">[</span><span class="s1">&#39;Holding Shares&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df_fund</span><span class="p">[</span><span class="s1">&#39;Net Asset Value&#39;</span><span class="p">]</span>
<span class="n">df_fund</span><span class="p">[</span><span class="s1">&#39;VaR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_fund</span><span class="p">[</span><span class="s1">&#39;Total Holding&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.015</span>
</pre></div>
</div>
<p>因为Archegos很少公布他们的持仓，可以说现在你已经使用了所有可以使用的信息。所以你对于结果也是有一些自信的，你去找你的老板，等待被表扬，但你的老板勃然大怒，他用了很久平复自己的心情，然后告诉你你忘了很多重要的事情：</p>
<ul class="simple">
<li><p><cite>股票的收盘价包含很多空值，空值应该被处理，而且不应该用上一个非空值填充，因为如果你用上一个非空值填充，会导致计算出的波动性相比真是波动性偏小。</cite></p></li>
<li><p><cite>老板想要的是关于Archegos风险的结论，而不是一堆风险指标。</cite></p></li>
<li><p><cite>你使用的股价是错误的，因为没有考虑到分红的影响。</cite></p></li>
<li><p><cite>Archegos买入并持仓这两支基金的唯一原因是Archegos可以利用它们来加杠杆，购买更多的股票，比如TCEHY US Equity。这两支基金起到了通道作用，你应该对这两支基金的持仓进行深入研究，而不是停留在表面。</cite></p></li>
</ul>
<p>事情现在变得越发复杂，你决定使用RiskQuantLib。首先，你需要新建一个文件夹，来作为数据分析项目的工程文件夹。新建的文件夹名为’Archegos_Risk’，然后你打开了命令终端，通过以下命令来创建一个RiskQuantLib工程：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">newRQL</span> <span class="n">Archegos_Risk</span>
</pre></div>
</div>
<p>在此步操作之后，你的文件夹看起来像这样：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">Archegos_Risk</span>
  <span class="o">--</span><span class="n">RiskQuantLib</span>
  <span class="o">--</span><span class="n">build</span><span class="o">.</span><span class="n">py</span>
  <span class="o">--</span><span class="n">main</span><span class="o">.</span><span class="n">py</span>
  <span class="o">--</span><span class="n">Build_Attr</span><span class="o">.</span><span class="n">xlsx</span>
  <span class="o">--</span><span class="n">Build_Instrument</span><span class="o">.</span><span class="n">xlsx</span>
</pre></div>
</div>
<p>打开 <code class="docutils literal notranslate"><span class="pre">Build_Attr.xlsx</span></code>，你对excel进行编辑，使得它看起来像这样：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 35%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>SecurityType</p></th>
<th class="head"><p>AttrName</p></th>
<th class="head"><p>AttrType</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Fund</p></td>
<td><p>netAssetValue</p></td>
<td><p>Number</p></td>
</tr>
<tr class="row-odd"><td><p>Fund</p></td>
<td><p>amount</p></td>
<td><p>Number</p></td>
</tr>
<tr class="row-even"><td><p>Fund</p></td>
<td><p>varPercentage</p></td>
<td><p>Number</p></td>
</tr>
<tr class="row-odd"><td><p>Stock</p></td>
<td><p>mktValue</p></td>
<td><p>Number</p></td>
</tr>
<tr class="row-even"><td><p>Stock</p></td>
<td><p>closeSeries</p></td>
<td><p>Series</p></td>
</tr>
</tbody>
</table>
<p>你关闭这个excel文件，然后通过以下终端命令来编译你的RiskQuantLib工程：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">build</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>在此之后，你打开 <code class="docutils literal notranslate"><span class="pre">RiskQuantLib.Security.Fund.fund</span></code> 以便于新增一个你自定义的类函数：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calVaR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">VaR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netAssetValue</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">varPercentage</span>
</pre></div>
</div>
<p>接着，你打开 <code class="docutils literal notranslate"><span class="pre">RiskQuantLib.Security.Stock.stock</span></code> 来新增一个自定义类函数：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calVaRPercentage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="kn">from</span> <span class="nn">RiskQuantLib.Tool.mathTool</span> <span class="kn">import</span> <span class="n">percentageOfSeries</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">varPercentage</span> <span class="o">=</span> <span class="n">percentageOfSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closeSeries</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="mi">99</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calVaR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">VaR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mktValue</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">varPercentage</span>
</pre></div>
</div>
<p><strong>注意：所有这些操作是在数据输入之前发生的，此时你并不知道数据的形状，列名等信息。</strong></p>
<p>接着进入你的项目工程文件夹根目录，打开 <code class="docutils literal notranslate"><span class="pre">main.py</span></code>，我们开始分析过程：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">RiskQuantLib.Module</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Read files</span>
<span class="n">df_stock_holding</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_one</span><span class="p">)</span>
<span class="n">df_stock_close</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_two</span><span class="p">)</span>
<span class="n">df_fund_holding</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_four</span><span class="p">)</span>
<span class="n">df_fund_nav</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_three</span><span class="p">)</span>

<span class="c1"># Initialize RQL list object</span>
<span class="n">fund_holdings</span> <span class="o">=</span> <span class="n">fundList</span><span class="p">()</span>
<span class="n">stock_holdings</span> <span class="o">=</span> <span class="n">stockList</span><span class="p">()</span>

<span class="c1"># Add securities to list</span>
<span class="n">fund_holdings</span><span class="o">.</span><span class="n">addFundSeries</span><span class="p">(</span><span class="n">df_fund_holding</span><span class="p">[</span><span class="s1">&#39;Fund&#39;</span><span class="p">],</span><span class="n">df_fund_holding</span><span class="p">[</span><span class="s1">&#39;Fund&#39;</span><span class="p">])</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">addStockSeries</span><span class="p">(</span><span class="n">df_stock_holding</span><span class="p">[</span><span class="s1">&#39;Stock&#39;</span><span class="p">],</span><span class="n">df_stock_holding</span><span class="p">[</span><span class="s1">&#39;Stock&#39;</span><span class="p">])</span>

<span class="c1"># Set input</span>
<span class="n">fund_holdings</span><span class="o">.</span><span class="n">setNetAssetValue</span><span class="p">(</span><span class="n">df_fund_nav</span><span class="p">[</span><span class="s1">&#39;Fund&#39;</span><span class="p">],</span><span class="n">df_fund_nav</span><span class="p">[</span><span class="s1">&#39;Net Asset Value&#39;</span><span class="p">])</span>
<span class="n">fund_holdings</span><span class="o">.</span><span class="n">setAmount</span><span class="p">(</span><span class="n">df_fund_holding</span><span class="p">[</span><span class="s1">&#39;Fund&#39;</span><span class="p">],</span><span class="n">df_fund_holding</span><span class="p">[</span><span class="s1">&#39;Holding Shares&#39;</span><span class="p">])</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">setMktValue</span><span class="p">(</span><span class="n">df_stock_holding</span><span class="p">[</span><span class="s1">&#39;Stock&#39;</span><span class="p">],</span><span class="n">df_stock_holding</span><span class="p">[</span><span class="s1">&#39;Holding Mkt Value&#39;</span><span class="p">])</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">setCloseSeries</span><span class="p">(</span><span class="n">df_stock_close</span><span class="p">)</span>
<span class="p">[</span><span class="n">fund</span><span class="o">.</span><span class="n">setVarPercentage</span><span class="p">(</span><span class="mf">0.15</span><span class="p">)</span> <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_holdings</span><span class="p">]</span>

<span class="c1"># Calculation</span>
<span class="n">fund_holdings</span><span class="o">.</span><span class="n">execFunc</span><span class="p">(</span><span class="s1">&#39;calVaR&#39;</span><span class="p">)</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">execFunc</span><span class="p">(</span><span class="s1">&#39;calVaRPercentage&#39;</span><span class="p">)</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">execFunc</span><span class="p">(</span><span class="s1">&#39;calVaR&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>现在，你的python源码变得更加易于阅读和修改了，不是么？你决定继续分析过程，接下来的一步是将你的结果保存为excel文件，所以你这样做：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data output</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">stock_holdings</span> <span class="o">+</span> <span class="n">fund_holdings</span>
<span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">[[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;VaR&#39;</span><span class="p">]])</span>
<span class="n">df_result</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>到现在为止，相比于用pandas进行数据分析，使用RiskQuantLib似乎更加麻烦。但是如果你注意到，在使用RiskQuantLib时，数据的输入，数据的处理，数据的输出是彼此独立的。改变其中的任何一个是不会影响到其他部分的运行的。（比如更改了输入文件的列名，你只需要对应更改RiskQuantLib输入部分的代码，分析和输出部分的代码完全不需要改动。）让我们来仔细看看源码，以便于了解这一点：</p>
<p><em>数据输入</em>：</p>
<p><code class="docutils literal notranslate"><span class="pre">main.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">RiskQuantLib.Module</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Read files</span>
<span class="n">df_stock_holding</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_one</span><span class="p">)</span>
<span class="n">df_stock_close</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_two</span><span class="p">)</span>
<span class="n">df_fund_holding</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_four</span><span class="p">)</span>
<span class="n">df_fund_nav</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">path_three</span><span class="p">)</span>

<span class="c1"># Initialize RQL list object</span>
<span class="n">fund_holdings</span> <span class="o">=</span> <span class="n">fundList</span><span class="p">()</span>
<span class="n">stock_holdings</span> <span class="o">=</span> <span class="n">stockList</span><span class="p">()</span>

<span class="c1"># Add securities to list</span>
<span class="n">fund_holdings</span><span class="o">.</span><span class="n">addFundSeries</span><span class="p">(</span><span class="n">df_fund_holding</span><span class="p">[</span><span class="s1">&#39;Fund&#39;</span><span class="p">],</span><span class="n">df_fund_holding</span><span class="p">[</span><span class="s1">&#39;Fund&#39;</span><span class="p">])</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">addStockSeries</span><span class="p">(</span><span class="n">df_stock_holding</span><span class="p">[</span><span class="s1">&#39;Stock&#39;</span><span class="p">],</span><span class="n">df_stock_holding</span><span class="p">[</span><span class="s1">&#39;Stock&#39;</span><span class="p">])</span>

<span class="c1"># Set input</span>
<span class="n">fund_holdings</span><span class="o">.</span><span class="n">setNetAssetValue</span><span class="p">(</span><span class="n">df_fund_nav</span><span class="p">[</span><span class="s1">&#39;Fund&#39;</span><span class="p">],</span><span class="n">df_fund_nav</span><span class="p">[</span><span class="s1">&#39;Net Asset Value&#39;</span><span class="p">])</span>
<span class="n">fund_holdings</span><span class="o">.</span><span class="n">setAmount</span><span class="p">(</span><span class="n">df_fund_holding</span><span class="p">[</span><span class="s1">&#39;Fund&#39;</span><span class="p">],</span><span class="n">df_fund_holding</span><span class="p">[</span><span class="s1">&#39;Holding Shares&#39;</span><span class="p">])</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">setMktValue</span><span class="p">(</span><span class="n">df_stock_holding</span><span class="p">[</span><span class="s1">&#39;Stock&#39;</span><span class="p">],</span><span class="n">df_stock_holding</span><span class="p">[</span><span class="s1">&#39;Holding Mkt Value&#39;</span><span class="p">])</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">setCloseSeries</span><span class="p">(</span><span class="n">df_stock_close</span><span class="p">)</span>
<span class="p">[</span><span class="n">fund</span><span class="o">.</span><span class="n">setVarPercentage</span><span class="p">(</span><span class="mf">0.15</span><span class="p">)</span> <span class="k">for</span> <span class="n">fund</span> <span class="ow">in</span> <span class="n">fund_holdings</span><span class="p">]</span>
</pre></div>
</div>
<p><em>数据分析</em></p>
<p><code class="docutils literal notranslate"><span class="pre">RiskQuantLib.Security.Fund.fund</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calVaR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">VaR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netAssetValue</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">varPercentage</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">RiskQuantLib.Security.Stock.stock</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calVaRPercentage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="kn">from</span> <span class="nn">RiskQuantLib.Tool.mathTool</span> <span class="kn">import</span> <span class="n">percentageOfSeries</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">varPercentage</span> <span class="o">=</span> <span class="n">percentageOfSeries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">closeSeries</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="mi">99</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calVaR</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">VaR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mktValue</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">varPercentage</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculation</span>
<span class="n">fund_holdings</span><span class="o">.</span><span class="n">execFunc</span><span class="p">(</span><span class="s1">&#39;calVaR&#39;</span><span class="p">)</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">execFunc</span><span class="p">(</span><span class="s1">&#39;calVaRPercentage&#39;</span><span class="p">)</span>
<span class="n">stock_holdings</span><span class="o">.</span><span class="n">execFunc</span><span class="p">(</span><span class="s1">&#39;calVaR&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><em>数据输出</em></p>
<p><code class="docutils literal notranslate"><span class="pre">main.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data output</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">stock_holdings</span> <span class="o">+</span> <span class="n">fund_holdings</span>
<span class="n">df_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">[[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;VaR&#39;</span><span class="p">]])</span>
<span class="n">df_result</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>当所有这些做完后，你可以将这个工程项目保存为模板。保存为模板的终端命令是这样的：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">saveRQL</span> <span class="n">Archegos_Risk</span>
</pre></div>
</div>
<p>如果之后几天，你的老板又希望你分析另一只基金，你可以用这个已经存在的模板工程来初始化新的工程，你可以这样使用：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tplRQL</span> <span class="n">Archegos_Risk</span> <span class="n">target_path</span>
</pre></div>
</div>
<p>这是RiskQuantLib的一个简单介绍，其中包含的内容包括 <em>创建一个项目</em>，<em>编译你的项目</em>，<em>分离数据处理流程</em>，<em>将项目保存为模板</em>，以及 <em>用保存的模板初始化新项目</em>。 你可能注意到了，我们并没有完全解决之前老板给我们的所有问题。为了解决这些问题，RiskQuantLib提供了很多高级函数。你可以参考RiskQuantLib的类文件说明来获取更多信息。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="modules.html" class="btn btn-neutral float-right" title="RiskQuantLib" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 .

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>